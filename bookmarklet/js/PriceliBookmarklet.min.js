/*CG APP. name: cg.PriceliBookmarklet,  Version: 1_0_0, Build time: 1436775740375, Author: Rhizome Networks LTD, Website: http://www.rhizomenet.com: . Copyright(c) 2009-2015 Rhizome Networks LTD <giladt@rhizomenet.com> */
!function(t){cg.CGButton=function(t,e){cg.CGApplication.call(this,t,e),this.container=e.container,this.label=null!=e.label?e.label:"ContentGlass",this.instanceId=cg.StringUtils.createUID(),this.PEER_STATUS_ICON_TIMER=2e3,this.type="button"},cg.CGButton.prototype=Object.create(cg.CGApplication.prototype),cg.CGButton.constructor=cg.CGButton,cg.CGButton.prototype=t.extend(cg.CGApplication.prototype,{tag:"button",top:100,left:null,right:50,position:"fixed",storagePath:"cg_button_"+cg.APP_ID,buttonsArray:[],htmlTemplates:{button:{html:"/../../apps/web/website_tools/button/js/CGButton.html",css:null}},init:function(t){cg.app=this,null==t?(this.initContentGlass(),this.startContentGlass()):this.contentGlass=t,this.render()},render:function(){if("undefined"!=typeof this.container&&null!==this.container){var t=this.hasFeatured();t&&null!=this.options.featured.label&&(this.label=this.options.featured.label);var e={container:this.container,label:this.label,instanceId:this.instanceId};this.buttonsArray.push(e),this.renderInContainer(e)}var i=this.findTags("button");for(var n in i)if(i.hasOwnProperty(n)){var o=i[n];o.instanceId=cg.StringUtils.createUID(),this.buttonsArray.push(o),this.renderInContainer(o)}},renderInContainer:function(e){var i=this,n=e.container,o=e.label,r=e.instanceId,s=this.isMenuEnabled();this.createButtonElm(s,t(n),r,o),t(n).css("z-index","3000000000");var a=this.loadTheme();if(null!=a&&this.setTheme(a),this.renderPeerStatus(n,r),this.registerThemeChangedHandlers(),cg.draggableButton||e.draggable){var c=t(n).find("#cg-button-drag-handle-"+r);c.show(),c.bind("click",function(t){t.stopPropagation()}),t(n).draggable({handle:"#cg-button-drag-handle-"+r,stop:function(e){i.saveLocation(e.clientX,e.clientY),t(n).css("right","initial")}}),this.loadDataFromStorage(),this.setButtonPosition(n)}},setButtonPosition:function(e){var e=t(e);"undefined"!=typeof this.top&&null!=this.top&&e.css("top",this.top+"px"),"undefined"!=typeof this.left&&null!=this.left?e.css("left",this.left+"px"):e.css("right",this.right+"px"),e.css("position",this.position)},generateNewUid:function(){this.instanceId=cg.StringUtils.createUID()},createButtonElm:function(t,e,i,n){var o={id:i,label:n,menu:t,title:cg.Lang.CGButtonDragHandleTitle},r=new cg.HTMLTemplate(this.htmlTemplates.button.html,e[0],o,this.htmlTemplates.button.css,!1);r.render(),this.prepareButton(i),t&&this.prepareSettingsButton(i),this.prepareContactsButton(i)},prepareSettingsButton:function(e){var i=t("#cg-button-"+e+"-settings");return i.attr("title",cg.Lang.CGButtonSettingsTitle),i.click(t.proxy(this.settingsButtonClicked,this))},settingsButtonClicked:function(t){this.getContentGlass().getSettingsView().openMainPage(),t.stopPropagation()},startPeerStatusTimer:function(){var t=this;cg.PeerStatusTimer=setInterval(function(){t.renderPeerStatus()},this.PEER_STATUS_ICON_TIMER)},renderPeerStatus:function(t,e){var i=this;this.setPeerStatusImage(e),this.setPeerStatusTitle(t,e),this.getContentGlass().bindEvent(cg.CGFinals.EVENT_SOCIAL_ACCOUNT_CONNECTED,function(n){var o=n.source;o.isConnected()&&(i.setPeerStatusImage(e),i.setPeerStatusTitle(t,e))},e+"-connected"),this.getContentGlass().bindEvent(cg.CGFinals.EVENT_SOCIAL_ACCOUNT_DISCONNECTED,function(n){var o=n.source;o.isConnected()||(i.setPeerStatusImage(e),i.setPeerStatusTitle(t,e))},e+"-disconnected")},setPeerStatusImage:function(e){var i="",n=this.getContentGlass().getSocialAccountsAdapter().getConnectedIntegrationCount();i=0==n?"cg-noneContactProviders":n<this.getContentGlass().getSocialAccountsAdapter().getAccountsCount()?"cg-someContactProviders":"cg-allContactProviders";var o=t("#cg-contacts-button-"+e);o.removeClass("cg-noneContactProviders"),o.removeClass("cg-someContactProviders"),o.removeClass("cg-allContactProviders"),o.addClass(i)},setPeerStatusTitle:function(e,i){var n="",o=this.getContentGlass().getSocialAccountsAdapter().getConnectedIntegrationCount(),r=t(e).find(".cg-button-login-state");0==o?(n=cg.Lang.PEERS_STATUS_NONE,r.show(),r.click(this.contactsButtonClicked.bind(this))):o<cg.MAX_SOCIAL_NETWORKS_AVAILABLE?(n=cg.Lang.PEERS_STATUS_SOME,r.hide()):(n=cg.Lang.PEERS_STATUS_ALL,r.hide());var s=t("#cg-contacts-button-"+i);s.attr("title",n)},prepareContactsButton:function(e){var i=t("#cg-contacts-button-"+e);return i.click(t.proxy(this.contactsButtonClicked,this))},contactsButtonClicked:function(t){this.getContentGlass().openView(cg.CGFinals.DEFAULT_VIEWS_LIB,"cg-SocialAccountsView",null,!0),t.stopImmediatePropagation()},prepareButtonWithMenu:function(){this.prepareButton().next().button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}}).click(function(){var e=t(this).parent().next().show().position({my:"left top",at:"left bottom",of:this});return t(document).on("click",function(){e.hide()}),!1}).parent().buttonset().next().hide().menu({select:t.proxy(this.menuClicked,this)})},prepareButton:function(e){var i=t("#cg-button-"+e).button();return i.click(t.proxy(this.createWidget,this))},createWidget:function(){var t=this.hasFeatured();if(t)try{this.createWidget(this.options.featured.lib,this.options.featured.type,this.options.featured.options,this.options.featured.id)}catch(e){console.log(e.message)}else this.getContentGlass().openView(cg.CGFinals.DEFAULT_VIEWS_LIB,"cg-WidgetSelector",null,!0)},menuClicked:function(t,e){t.stopImmediatePropagation();try{var i=e.item.context.getAttribute("action");"clear"==i?this.getContentGlass().removeAllWidgets():"networks"==i?this.getContentGlass().openView(cg.CGFinals.DEFAULT_VIEWS_LIB,"cg-SocialAccountsView",null):"share"==i?this.getContentGlass().syncLocalAndRemoteAllLayers():"widgets"==i?this.getContentGlass().openView(cg.CGFinals.DEFAULT_VIEWS_LIB,"cg-WidgetSelector",{libraries:this.options.libraries}):"themes"==i?this.getContentGlass().openView(cg.CGFinals.DEFAULT_VIEWS_LIB,"cg-ThemesView",null):"install"==i&&this.getContentGlass().openView(cg.CGFinals.DEFAULT_VIEWS_LIB,"cg-GuideView",null)}catch(n){console.log(n)}},hasFeatured:function(){return null!=this.options.featured&&null!=this.options.featured.lib&&this.options.featured.lib.length>0&&null!=this.options.featured.type&&this.options.featured.type.length>0},isMenuEnabled:function(){return null==this.options.menu_enabled||1==this.options.menu_enabled},saveTheme:function(t){this.getContentGlass().getUtilityStore().setItem("theme",t)},loadTheme:function(){var t=this.getContentGlass().getUtilityStore();return CGAPI.CGButtonElem=this,t.hasItem("theme")?t.getItem("theme"):null},saveLocation:function(t,e){this.top=e,this.left=t,this.buttonChange()},buttonChange:function(){var t=this.prepareButtonForStorage();this.checkStorage()&&localStorage.setItem(this.storagePath,t)},prepareButtonForStorage:function(){var t={};return t.top=this.top,t.left=this.left,JSON.stringify(t)},checkStorage:function(){return"undefined"!=typeof Storage?!0:!1},loadDataFromStorage:function(){if(this.checkStorage()){var t=localStorage.getItem(this.storagePath);if(!cg.StringUtils.isEmpty(t)){t=JSON.parse(t);for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])}}}})}(cg.jQuery),cg.he=function(){this.StoreNotFoundError="החנות לא נתמכת!",this.ItemPriceHeader="מחיר",this.ItemStoreHeader="חנות",this.ItemBranchHeader="סניף",this.CityAndAddressUnknown="לא ניתנה כתובת"},cg.en=function(){this.StoreNotFoundError="Store isn't supported yet!",this.ItemPriceHeader="Price",this.ItemStoreHeader="Branch",this.ItemBranchHeader="Store",this.CityAndAddressUnknown="Address hasn't been given!"},function(t){cg.PriceliBookmarkletWidgetLibrary=function(t){cg.CGWidgetLibrary.call(this,t)},cg.PriceliBookmarkletWidgetLibrary.prototype=Object.create(cg.CGWidgetLibrary.prototype),cg.PriceliBookmarkletWidgetLibrary.prototype.constructor=cg.PriceliBookmarkletWidgetLibrary,cg.PriceliBookmarkletWidgetLibrary.prototype.createLibWidget=function(e,i){var n=this.getDefaultOptions();switch(null!=i&&(n=t.extend(n,i)),n.preferredLayer=cg.CGFinals.LAYER_ID_DOMAIN,e){default:throw new cg.CGException("Widget type not found '"+e+"' in PriceliWidgetLibrary.js")}return widget},cg.PriceliBookmarkletWidgetLibrary.prototype.widgets=[],cg.PriceliBookmarkletWidgetLibrary.prototype.getGallery=function(){return this.getConventionalStatus(),{categories:{"default":{image:cg.MiscUtils.toFullThemeUrl(cg.CGFinals.BASIC_WIDGETS_LIBRARY_IMAGES_PATH),title:"Default",items:[]}}}}}(cg.jQuery),function(t){t.widget("cg.ItemDialogView",t.cg.BasicView,{options:{style:{background:"white",height:"100%",width:"100%"},content:{data:null},draggable:!1,resizable:!1,ownerWidget:null,title:"Items",enableToolbar:!1},renderViewContent:function(){if(null===this.options.content.data)throw"No items int view data";var t=this.options.content.data;if(t.length>0){var e={id:this.getId(),items:this.options.content.data,item_name:t[0].item_name},i=new cg.HTMLTemplate(cg.PRICELI_HOST+"/bookmarklet/js/views/web/item_dialog_view/htmls/ItemsDialogView.html",this.contentElement[0],e,cg.PRICELI_HOST+"/bookmarklet/js/views/web/item_dialog_view/ItemsDialogView.css",!1);i.render()}else this.showNoItemsFromServerMessage()},showNoItemsFromServerMessage:function(){var t=new cg.HTMLTemplate(cg.PRICELI_HOST+"/bookmarklet/js/views/web/item_dialog_view/htmls/NoItemsReceived.html",this.contentElement[0],{},cg.PRICELI_HOST+"/bookmarklet/js/views/web/item_dialog_view/ItemsDialogView.css",!1);t.render()},setToolbar:function(){var e=t(document.createElement("div"));e.addClass("toolbar");var i=this,n=t(document.createElement("div"));n.addClass("item_dialog_close_btn"),n.button({icons:{primary:"ui-icon-closethick"}}),n.click(function(){var t=confirm("Are you sure You want to close the view?");if(t){var e=i.widget();e.remove()}}),e.append(n),this.element.prepend(e)}})}(cg.jQuery),function(t){cg.PriceliWebViewsLibrary=function(t){cg.CGWidgetLibrary.call(this,t)},cg.PriceliWebViewsLibrary.prototype=Object.create(cg.CGWidgetLibrary.prototype),cg.PriceliWebViewsLibrary.prototype.constructor=cg.PriceliWebViewsLibrary,cg.PriceliWebViewsLibrary.prototype.createLibWidget=function(e,i){switch(null==i&&(i={}),e){case"cg-ItemDialogView":var n=new t.cg.ItemDialogView(i)}return n}}(cg.jQuery),function(t){cg.PriceliBookmarkletApplication=function(t,e){cg.CGButton.call(this,t,e)},cg.PriceliBookmarkletApplication.prototype=Object.create(cg.CGApplication.prototype),cg.PriceliBookmarkletApplication.constructor=cg.PriceliBookmarkletApplication,cg.PriceliBookmarkletApplication.Lang={},cg.PriceliBookmarkletApplication.prototype=t.extend(cg.CGApplication.prototype,{server_url:"http://www.priceli.co.il/v1",storagePath:"cg_priceli_bookmarklet"+cg.APP_ID,htmlTemplates:{button:{html:cg.PRICELI_HOST+"/bookmarklet/js/PriceliBookmarkletApplication.html",css:cg.PRICELI_HOST+"/bookmarklet/css/PriceliBookmarkletApplication.css"}},bookmarkletContainerClass:"priceli",init:function(){cg.app=this,this.initContentGlass(),this.startContentGlass(),cg.BookmarkletLang=new cg.BaseLang("he","","cg"),cg.csrf=cg.priceliClientId+"@"+cg.priceliClientName,this.render(),this.searchProductsBySKU()},stopBookmarkletLoader:function(){t("#"+cg.bookmarkletLoaderId).remove()},render:function(){if("undefined"==typeof this.container||null===this.container)throw"Container hasn't been given!";var e=t(this.container),i=t(document.createElement("div"));i.addClass(this.bookmarkletContainerClass),e.append(i)},searchProductsBySKU:function(){if(!cg.bookmarkletSKU)throw"Product SKU isn't present!";this.getProductBySKUFromServer(cg.bookmarkletSKU)},getProductBySKUFromServer:function(t){var e=this,i=cg.PRICELI_HOST+"/v1/portal/code",n={bookmarklet:!0,item_code:t};cg.NetUtils.httpGet(i,n,function(t){e.showView(t.data)},function(t,i,n,o){e.showError(o)})},showView:function(e){var i,n=cg.CGFinals.DEFAULT_VIEWS_LIB,o="cg-ItemDialogView",r={content:{data:e}},s=this.getContentGlass().viewsLibs[n];return i=s.createWidget(o,"undefined"!=typeof r?r:null),i.contentGlass=this.getContentGlass(),this.stopBookmarkletLoader(),t("."+this.bookmarkletContainerClass).append(i.element),i.onCreate(),i.renderViewContent(),i},showError:function(e){var i=cg.$(document.createElement("div"));i.html(e+'<br>לכל בעיה נוספת אפשר ל<a style="text-decoration: underline; color: blue" href="http://developers.priceli.co.il/contact">צור קשר</a>. איתנו ונשמח לעזור'),i.css("direction","rtl"),t(document.body).append(i),i.dialog({resizable:!1,height:190,dialogClass:"cg",modal:!0,buttons:{Ok:function(){cg.$(this).dialog("close"),cg.$(this).remove()}}}),i.parent().find(".ui-dialog-buttonpane").css("margin","-1px 0 0 0")}})}(cg.jQuery);var name="CGPriceliBookmarkletGlassManifest_"+(new Date).getTime();window.cg[name]={mName:name,contentglass_manifest:!0,author:"Rhizome Networks LTD",provider_url:"http://www.rhizomenet.com",account_id:"1",scripts:{dev:{js:[{src:"/js/lang/he.js"},{src:"/js/lang/en.js"},{src:"/js/widgets/PriceliBookmarkletWidgetLibrary.js"},{src:"/js/views/web/item_dialog_view/ItemsDialogView.js"},{src:"/js/views/web/PriceliWebViewsLibrary.js"}]},prod:{js:[]}},widget_libraries:[{id:"rhz-basic",name:"Basic",description:"Basic Sharing",constructor:"cg.PriceliBookmarkletWidgetLibrary",index:100,version:"0.1",account_id:"1"}],view_libraries:[{id:cg.CGFinals.DEFAULT_VIEWS_LIB,name:"web views",description:"Priceli web views",constructor:"cg.PriceliWebViewsLibrary",index:1,version:"0.1",account_id:"1"}],layers:[{layer_id:"domain",glass_id:"@domain",glass_type:"1.2",dimensions:{},condition:{not_or:["isShowMarkersOnly"]},visibility:{not_or:["isShowPublicOnly"]}}],social_accounts:[{account_name:"default",provider_id:"google",provider_name:"google",constructor:"cg.ServerSocialAccount"},{account_name:"default",provider_id:"google_plus",provider_name:"google_plus",constructor:"cg.ServerSocialAccount"},{account_name:"default",provider_id:"instagram",provider_name:"instagram",constructor:"cg.ServerSocialAccount"},{account_name:"default",provider_id:"twitter",provider_name:"twitter",constructor:"cg.ServerSocialAccount"},{account_name:"default",provider_id:"facebook",provider_name:"facebook",constructor:"cg.ServerSocialAccount"}]};
